<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Supporting Audio Files</title>
  <style>
    :root {
      color-scheme: light dark;
      --accent: #0f766e;
      --muted: #64748b;
      --border: #cbd5e1;
      --card: #f8fafc;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 0;
      background: #f1f5f9;
      color: #0f172a;
    }

    header {
      background: #0f172a;
      color: #e2e8f0;
      padding: 24px 20px;
      text-align: center;
    }

    header h1 {
      margin: 0 0 8px;
      font-size: 1.75rem;
      letter-spacing: -0.02em;
    }

    header p {
      margin: 0;
      color: #cbd5e1;
    }

    main {
      max-width: 1024px;
      margin: 24px auto 48px;
      padding: 0 16px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    }

    .lead {
      margin: 0 0 16px;
      color: var(--muted);
      font-size: 0.98rem;
    }

    .sections {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .section {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
    }

    .section-title {
      margin: 0 0 6px;
      font-size: 1.1rem;
      letter-spacing: -0.01em;
    }

    .section-desc {
      margin: 0 0 12px;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .group {
      border: 1px dashed var(--border);
      border-radius: 10px;
      padding: 12px;
      background: #f8fafc;
      margin-bottom: 10px;
    }

    .group-title {
      margin: 0 0 8px;
      font-size: 1rem;
      font-weight: 700;
      color: #0f172a;
    }

    .clip-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
    }

    .clip-card {
      background: white;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .clip-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .clip-title {
      margin: 0;
      font-weight: 600;
      font-size: 0.98rem;
      color: #0f172a;
    }

    .clip-meta {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .clip-meta button {
      background: none;
      border: none;
      color: var(--accent);
      cursor: pointer;
      padding: 0;
      font-weight: 600;
    }

    .clip-meta button:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 3px;
    }

    .clip-card audio {
      width: 100%;
      display: block;
      min-width: 0;
    }

    .error {
      color: #b91c1c;
      font-weight: 600;
      margin-top: 12px;
    }

    @media (prefers-color-scheme: dark) {
      body { background: #0b1221; color: #e2e8f0; }
      header { background: #0b1221; }
      .card { background: #0f172a; border-color: #1f2937; }
      .section { background: #0f172a; border-color: #1f2937; }
      .group { background: #111827; border-color: #1f2937; }
      .clip-card { background: #0b1221; border-color: #1f2937; }
      .clip-title { color: #e2e8f0; }
      /* --border: #1f2937; */
    }
  </style>
</head>
<body>
  <header>
    <h1>Supporting Audio Files</h1>
    <p>Stream any audio asset in this repository without downloading.</p>
  </header>
  <main>
    <section class="card" aria-live="polite">
      <p class="lead">Ordered to match the sections and tables in <code>report.md</code>. Use the copy buttons to share a deeplink to any clip.</p>
      <div id="sections" class="sections"></div>
      <p id="error" class="error" hidden></p>
    </section>
  </main>

  <script>
    const sectionsContainer = document.getElementById('sections');
    const errorEl = document.getElementById('error');
    const params = new URLSearchParams(window.location.search);
    const deeplinkTarget = params.get('track') ? decodeURIComponent(params.get('track')) : null;
    const basePath = window.location.pathname.replace(/\/[^/]*$/, '');

    const reportSections = [
      {
        id: 'step1',
        title: 'Step 1.2 — Initial listening & expressiveness',
        description: 'General quality and nuance checks referenced in report section 1.2.',
        groups: [
          {
            heading: 'Baseline quality',
            clips: [
              { title: 'Cartesia — expressive baseline', file: 'highly_expressive_cartesia_output_example.mp3' },
              { title: 'ElevenLabs — flat baseline', file: 'flat_sounding_elevenlabs_output_example.mp3' },
            ],
          },
          {
            heading: 'Hamlet “to be” prompt nuance',
            clips: [
              { title: 'Cartesia — prompt variant 1', file: 'to_be1_cartesia_tts_output.mp3' },
              { title: 'Cartesia — prompt variant 2', file: 'to_be2_cartesia_tts_output.mp3' },
            ],
          },
        ],
      },
      {
        id: 'step2-pronunciation',
        title: 'Step 2.1 — Pronunciation (locale + code-switching)',
        description: 'Matches the pronunciation table in report section 2.1.',
        groups: [
          {
            heading: 'Loanwords #1 — Geneviève / Guadalajara / São Paulo',
            clips: [
              { title: 'Cartesia', file: 'locale_cartesia_output.mp3' },
              { title: 'ElevenLabs', file: 'locale_elevenlabs_output.mp3' },
            ],
          },
          {
            heading: 'Loanwords #2 — Nguyễn meets Siobhán at the café',
            clips: [
              { title: 'Cartesia', file: 'cartesia_loanwords_cafe.mp3' },
              { title: 'ElevenLabs', file: 'elevenlabs_loanwords_cafe.mp3' },
            ],
          },
          {
            heading: 'Locale-specific pronunciation #1 — laboratory (UK)',
            clips: [
              { title: 'Cartesia (Charlotte)', file: 'locale_specific_pronunciation_cartesia_output_charlotte.mp3' },
              { title: 'ElevenLabs (Lily)', file: 'locale_specific_pronunciation_elevenlabs_output_lily.mp3' },
            ],
          },
          {
            heading: 'Locale-specific pronunciation #2 — aluminium (UK)',
            clips: [
              { title: 'Cartesia (Charlotte)', file: 'locale_specific2_pronunciation_cartesia_output_charlotte.mp3' },
              { title: 'ElevenLabs (Lily)', file: 'locale_specific2_pronunciation_elevenlabs_output_lily.mp3' },
            ],
          },
          {
            heading: 'Locale-specific loanwords — croissants & niche (UK)',
            clips: [
              { title: 'Cartesia (Charlotte)', file: 'cartesia_locale-specific_loanwords_charlotte_uk.mp3' },
              { title: 'ElevenLabs (Lily)', file: 'elevenlabs_locale-specific_loanwords_lily_uk.mp3' },
            ],
          },
        ],
      },
      {
        id: 'step2-acronyms',
        title: 'Step 2.1 — Acronyms, symbols & numbers',
        description: 'Matches the acronyms/symbols/numbers table in report section 2.1.',
        groups: [
          {
            heading: 'Filenames — config.yaml / etc directory',
            clips: [
              { title: 'Cartesia', file: 'filenames_cartesia_output.mp3' },
              { title: 'ElevenLabs', file: 'filenames_elevenlabs_output.mp3' },
            ],
          },
          {
            heading: 'Acronyms — Ph.D. from MIT',
            clips: [
              { title: 'Cartesia', file: 'phd_cartesia_output.mp3' },
              { title: 'ElevenLabs', file: 'phd_elevenlabs_output.mp3' },
            ],
          },
          {
            heading: 'Numbers — 03/04/05 at 06:07',
            clips: [
              { title: 'Cartesia', file: 'date_cartesia_output.mp3' },
              { title: 'ElevenLabs', file: 'date_elevenlabs_output.mp3' },
            ],
          },
        ],
      },
    ];

    function buildDeeplink(file) {
      const url = new URL(window.location.href);
      url.searchParams.set('track', file);
      return url.toString();
    }

    function audioUrl(file) {
      return `${basePath}/supporting_files/${encodeURIComponent(file)}`;
    }

    function renderClip(clip) {
      const card = document.createElement('div');
      card.className = 'clip-card';
      const head = document.createElement('div');
      head.className = 'clip-head';
      const title = document.createElement('p');
      title.className = 'clip-title';
      title.textContent = clip.title;

      const meta = document.createElement('div');
      meta.className = 'clip-meta';
      const shareButton = document.createElement('button');
      shareButton.type = 'button';
      shareButton.textContent = 'Copy deeplink';
      shareButton.addEventListener('click', async () => {
        const link = buildDeeplink(clip.file);
        await navigator.clipboard.writeText(link);
        shareButton.textContent = 'Copied!';
        setTimeout(() => (shareButton.textContent = 'Copy deeplink'), 1500);
      });
      meta.append(shareButton);

      head.append(title, meta);

      const audio = document.createElement('audio');
      audio.setAttribute('controls', '');
      audio.setAttribute('preload', 'none');
      audio.dataset.file = clip.file;
      audio.src = audioUrl(clip.file);

      card.append(head, audio);
      return card;
    }

    function renderSection(section) {
      const wrapper = document.createElement('div');
      wrapper.className = 'section';
      wrapper.id = section.id;

      const title = document.createElement('h2');
      title.className = 'section-title';
      title.textContent = section.title;
      wrapper.appendChild(title);

      if (section.description) {
        const desc = document.createElement('p');
        desc.className = 'section-desc';
        desc.textContent = section.description;
        wrapper.appendChild(desc);
      }

      section.groups.forEach((group) => {
        const groupEl = document.createElement('div');
        groupEl.className = 'group';

        const groupTitle = document.createElement('p');
        groupTitle.className = 'group-title';
        groupTitle.textContent = group.heading;
        groupEl.appendChild(groupTitle);

        const grid = document.createElement('div');
        grid.className = 'clip-grid';
        group.clips.forEach((clip) => grid.appendChild(renderClip(clip)));

        groupEl.appendChild(grid);
        wrapper.appendChild(groupEl);
      });

      sectionsContainer.appendChild(wrapper);
    }

    function renderAll() {
      try {
        reportSections.forEach(renderSection);

        if (deeplinkTarget) {
          const audioEls = Array.from(document.querySelectorAll('audio[data-file]'));
          const match = audioEls.find((el) => el.dataset.file === deeplinkTarget);
          if (match) {
            match.scrollIntoView({ behavior: 'smooth', block: 'center' });
            match.play().catch(() => {});
          } else {
            errorEl.hidden = false;
            errorEl.textContent = `Clip "${deeplinkTarget}" not found.`;
          }
        }
      } catch (err) {
        console.error(err);
        errorEl.hidden = false;
        errorEl.textContent = 'Unable to render audio sections.';
      }
    }

    renderAll();
  </script>
</body>
</html>
